apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: unbound1
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: unbound1
        type: dns
    spec:
      containers:
      - name: unbound1
        image: {{.Values.image_unbound}}:{{printf "%s" .Values.image_unbound_tag}}
        imagePullPolicy: {{ .Values.image_pullPolicy }}
        securityContext:
         privileged: true
        ports:
          - name: dns-tcp
            containerPort: 53
            protocol: TCP
          - name: dns-udp
            containerPort: 53
            protocol: UDP
        volumeMounts:
          - name: unbound-conf
            mountPath: /etc/unbound
      - name: metric
        image: {{.Values.image_unbound_exporter}}:{{printf "%s" .Values.image_unbound_exporter_tag}}
        imagePullPolicy: {{ .Values.image_pullPolicy }}
        ports:
          - name: metrics
            containerPort: {{.Values.port_unbound_exporter}}
        volumeMounts:
          - name: unbound-conf
            mountPath: /etc/unbound
      volumes:
      - name: unbound-conf
        configMap:
          name: unbound1
